<!DOCTYPE html>
<html lang="uk">
<head>
  <meta charset="UTF-8"/>
  <title>–ö–∞—Ä—Ç–∞ –ü–æ–≤—ñ—Ç—Ä—è–Ω–∏—Ö –¶—ñ–ª–µ–π ‚Äî –ê–≤—Ç–æ—Ä–∏–∑–∞—Ü—ñ—è –∑ "–ó–∞–ø–∞–º‚Äô—è—Ç–∞—Ç–∏ –º–µ–Ω–µ"</title>
  <link rel="stylesheet" href="https://unpkg.com/leaflet/dist/leaflet.css"/>
  <style>
    html, body { margin:0; height:100%; font-family:'Segoe UI',sans-serif; display:flex; flex-direction:column; }
    #header { display:flex; flex-wrap:wrap; gap:8px; padding:10px; background:#2c3e50; color:white; align-items:center; }
    .status-item { display:flex; gap:6px; align-items:center; }
    .status-indicator { padding:6px 10px; border-radius:5px; font-weight:700; color:white; min-width:160px; text-align:center; }
    .inactive { background:#27ae60; }
    .active { background:#c0392b; }
    button { padding:6px 12px; border:none; border-radius:5px; background:#2980b9; color:white; cursor:pointer; }
    button:hover:not(:disabled) { background:#1f6391; }
    button:disabled { background:gray; cursor:not-allowed; }
    #counter { font-size:18px; font-weight:600; margin-right:auto; }
    #map { flex:1; min-height:400px; }
    #legend { padding:12px; font-size:13px; background:white; border-top:1px solid #ddd; line-height:1.4; }
    #login-panel { display:flex; align-items:center; gap:10px; }
    #remember-label { user-select:none; cursor:pointer; font-weight:600; }
  </style>
</head>
<body>
  <div id="header">
    <div id="counter">–í—Å—å–æ–≥–æ —Ü—ñ–ª–µ–π: 0</div>

    <div class="status-item">
      <div id="strat-ind" class="status-indicator inactive">–°—Ç—Ä–∞—Ç–µ–≥—ñ—á–Ω–∞ –∞–≤—ñ–∞—Ü—ñ—è: –Ω–µ –∞–∫—Ç–∏–≤–Ω–∞</div>
      <button id="btn-strat" disabled>–ó–º—ñ–Ω–∏—Ç–∏ —Å—Ç–∞—Ç—É—Å</button>
    </div>
    <div class="status-item">
      <div id="takeoff-ind" class="status-indicator inactive">–ó–ª—ñ—Ç –¢—É‚Äë95/160: –Ω–µ –≤—ñ–¥–±—É–ª–æ—Å—è</div>
      <button id="btn-takeoff" disabled>–ó–º—ñ–Ω–∏—Ç–∏ —Å—Ç–∞—Ç—É—Å</button>
    </div>
    <div class="status-item">
      <div id="mig-ind" class="status-indicator inactive">–ó–ª—ñ—Ç –ú—ñ–ì‚Äë31–ö: –Ω–µ –≤—ñ–¥–±—É–≤—Å—è</div>
      <button id="btn-mig" disabled>–ó–º—ñ–Ω–∏—Ç–∏ —Å—Ç–∞—Ç—É—Å</button>
    </div>
    <div class="status-item">
      <div id="ballistic-ind" class="status-indicator inactive">–ó–∞–≥—Ä–æ–∑–∞ –±–∞–ª—ñ—Å—Ç–∏–∫–∞: –≤—ñ–¥—Å—É—Ç–Ω—è</div>
      <button id="btn-ballistic" disabled>–ó–º—ñ–Ω–∏—Ç–∏ —Å—Ç–∞—Ç—É—Å</button>
    </div>

    <div id="login-panel">
      <button id="btn-login">–£–≤—ñ–π—Ç–∏</button>
      <label id="remember-label"><input type="checkbox" id="chk-remember"> –ó–∞–ø–∞–º‚Äô—è—Ç–∞—Ç–∏ –º–µ–Ω–µ</label>
    </div>

    <button id="btn-add-target" disabled>–î–æ–¥–∞—Ç–∏ —Ü—ñ–ª—å</button>
    <button id="btn-add-takeoff" disabled>–î–æ–¥–∞—Ç–∏ –∑–ª—ñ—Ç</button>
    <button id="btn-add-plane" disabled>–î–æ–¥–∞—Ç–∏ –ª—ñ—Ç–∞–∫</button>
    <button id="btn-add-launcher" disabled>–î–æ–¥–∞—Ç–∏ –ø—É—Å–∫–æ–≤—É —É—Å—Ç–∞–Ω–æ–≤–∫—É</button>
    <button id="btn-refresh">–û–Ω–æ–≤–∏—Ç–∏</button>
    <button id="btn-clear" disabled>–û—á–∏—Å—Ç–∏—Ç–∏</button>
  </div>

  <div id="map"></div>

  <div id="legend">
    <b>–ü–æ–∑–Ω–∞—á–µ–Ω–Ω—è:</b><br>
    üî∫ –®–∞—Ö–µ–¥ ‚Ä¢ üî¥ –•‚Äë101 ‚Ä¢ üîµ –ö–∏–Ω–¥–∂–∞–ª ‚Ä¢ üü£ –ö–∞–ª—ñ–±—Ä ‚Ä¢ ‚¨õ –•‚Äë22 ‚Ä¢ ‚¨õ –Ü—Å–∫–∞–Ω–¥–µ—Ä‚Äë–ú ‚Ä¢ ‚¨õ –Ü—Å–∫–∞–Ω–¥–µ—Ä‚Äë–ö ‚Ä¢ ‚¨õ KN‚Äë23<br>
    ‚úàÔ∏è –¢—É‚Äë95 (—á–µ—Ä–≤–æ–Ω–∏–π) / –¢—É‚Äë160 (—Ñ—ñ–æ–ª–µ—Ç–æ–≤–∏–π) / –¢—É‚Äë22–ú3 (–æ—Ä–∞–Ω–∂–µ–≤–∏–π) / –ú—ñ–ì‚Äë31–ö (–±–µ—Ä—é–∑–æ–≤–∏–π)<br>
    üöÄ –ü—É—Å–∫–æ–≤–∞ —É—Å—Ç–∞–Ω–æ–≤–∫–∞ (—á–µ—Ä–≤–æ–Ω–∞ —Ä–∞–∫–µ—Ç–∞)<br>
    üì° –ê–µ—Ä–æ–¥—Ä–æ–º (—Ä–∞–¥–∞—Ä)<br>
    <b>–°—Ç—Ä—ñ–ª–∫–∏:</b> –ø—É–Ω–∫—Ç–∏—Ä–Ω—ñ –¥–æ –º—ñ—Å—Ü—è –ø—Ä–∏–∑–Ω–∞—á–µ–Ω–Ω—è
  </div>

  <script src="https://unpkg.com/leaflet/dist/leaflet.js"></script>
  <script>
    // –ê–≤—Ç–æ—Ä–∏–∑–∞—Ü—ñ—è –∑ "–ó–∞–ø–∞–º‚Äô—è—Ç–∞—Ç–∏ –º–µ–Ω–µ"
    let isLoggedIn = false;

    const loginBtn = document.getElementById("btn-login");
    const rememberCheckbox = document.getElementById("chk-remember");
    const protectedBtns = [
      document.getElementById("btn-add-target"),
      document.getElementById("btn-add-takeoff"),
      document.getElementById("btn-add-plane"),
      document.getElementById("btn-add-launcher"),
      document.getElementById("btn-clear"),
      document.getElementById("btn-strat"),
      document.getElementById("btn-takeoff"),
      document.getElementById("btn-mig"),
      document.getElementById("btn-ballistic")
    ];

    // –ü–µ—Ä–µ–≤—ñ—Ä—è—î–º–æ —á–∏ –∑–±–µ—Ä–µ–∂–µ–Ω–æ –∞–≤—Ç–æ—Ä–∏–∑–∞—Ü—ñ—é
    function checkStoredLogin() {
      const stored = localStorage.getItem('loggedIn');
      if (stored === 'true') {
        isLoggedIn = true;
      }
    }

    function updateAuthUI() {
      protectedBtns.forEach(btn => btn.disabled = !isLoggedIn);
      loginBtn.textContent = isLoggedIn ? "–í–∏–π—Ç–∏" : "–£–≤—ñ–π—Ç–∏";
      rememberCheckbox.disabled = isLoggedIn; // –ø—ñ—Å–ª—è –≤—Ö–æ–¥—É –∑–∞–±–æ—Ä–æ–Ω—è—î–º–æ –∑–º—ñ–Ω—é–≤–∞—Ç–∏ —á–µ–∫–±–æ–∫—Å
      if(!isLoggedIn) rememberCheckbox.checked = false;
    }

    loginBtn.onclick = () => {
      if (isLoggedIn) {
        isLoggedIn = false;
        localStorage.removeItem('loggedIn');
        alert("–í–∏ –≤–∏–π—à–ª–∏.");
      } else {
        const login = prompt("–õ–æ–≥—ñ–Ω:");
        const pass = prompt("–ü–∞—Ä–æ–ª—å:");
        if (login === "admin" && pass === "1234") {
          isLoggedIn = true;
          alert("–£—Å–ø—ñ—à–Ω–∏–π –≤—Ö—ñ–¥!");
          if (rememberCheckbox.checked) {
            localStorage.setItem('loggedIn', 'true');
          }
        } else {
          alert("–ù–µ–≤—ñ—Ä–Ω—ñ –¥–∞–Ω—ñ.");
          return;
        }
      }
      updateAuthUI();
    };

    checkStoredLogin();
    updateAuthUI();

    // –ö–∞—Ä—Ç–∞
    const map = L.map('map').setView([48.4,31.2],6);
    L.tileLayer('https://{s}.tile.openstreetmap.org/{z}/{x}/{y}.png',{ attribution:'¬© OSM' }).addTo(map);

    const ctr = document.getElementById('counter');

    // –ü–µ—Ä–µ–º–∏–∫–∞—á —Å—Ç–∞—Ç—É—Å—ñ–≤
    function toggle(el,textOn,textOff){
      if(!isLoggedIn) {
        alert("–ë—É–¥—å –ª–∞—Å–∫–∞, —É–≤—ñ–π–¥—ñ—Ç—å, —â–æ–± –∑–º—ñ–Ω—é–≤–∞—Ç–∏ —Å—Ç–∞—Ç—É—Å–∏.");
        return false;
      }
      const active = el.classList.toggle('active');
      el.classList.toggle('inactive',!active);
      el.textContent = active ? textOn : textOff;
      saveStatus();
      return active;
    }

    document.getElementById('btn-strat').onclick = ()=>toggle(document.getElementById('strat-ind'),
      '–°—Ç—Ä–∞—Ç–µ–≥—ñ—á–Ω–∞ –∞–≤—ñ–∞—Ü—ñ—è: –∞–∫—Ç–∏–≤–Ω–∞', '–°—Ç—Ä–∞—Ç–µ–≥—ñ—á–Ω–∞ –∞–≤—ñ–∞—Ü—ñ—è: –Ω–µ –∞–∫—Ç–∏–≤–Ω–∞');
    document.getElementById('btn-takeoff').onclick = ()=>toggle(document.getElementById('takeoff-ind'),
      '–ó–ª—ñ—Ç –¢—É‚Äë95/160: –≤—ñ–¥–±—É–≤—Å—è', '–ó–ª—ñ—Ç –¢—É‚Äë95/160: –Ω–µ –≤—ñ–¥–±—É–ª–æ—Å—è');
    document.getElementById('btn-mig').onclick = ()=>toggle(document.getElementById('mig-ind'),
      '–ó–ª—ñ—Ç –ú—ñ–ì‚Äë31–ö: –≤—ñ–¥–±—É–≤—Å—è', '–ó–ª—ñ—Ç –ú—ñ–ì‚Äë31–ö: –Ω–µ –≤—ñ–¥–±—É–≤—Å—è');
    document.getElementById('btn-ballistic').onclick = ()=>toggle(document.getElementById('ballistic-ind'),
      '–ó–∞–≥—Ä–æ–∑–∞ –±–∞–ª—ñ—Å—Ç–∏–∫–∞: –∞–∫—Ç–∏–≤–Ω–∞', '–ó–∞–≥—Ä–æ–∑–∞ –±–∞–ª—ñ—Å—Ç–∏–∫–∞: –≤—ñ–¥—Å—É—Ç–Ω—è');

    // –õ–æ–≥—ñ–∫–∞ –¥–æ–¥–∞–≤–∞–Ω–Ω—è —Ü—ñ–ª–µ–π —Ç–∞ –æ–±‚Äô—î–∫—Ç—ñ–≤
    let idCnt = 0, targets = new Map();
    let state = {}, phase = 0;

    function updateCtr(){
      ctr.textContent = `–í—Å—å–æ–≥–æ —Ü—ñ–ª–µ–π: ${targets.size}`;
    }

    // –Ü–∫–æ–Ω–∫–∏ –¥–ª—è —Ü—ñ–ª–µ–π
    function createIcon(type,count=1,angle=0){
      let svg = '';
      switch(type){
        case '—à–∞—Ö–µ–¥': svg='<polygon points="15,0 30,30 0,30" fill="red"/>'; break;
        case '—Ö-101': svg='<rect x="6" y="7" width="18" height="16" fill="red"/><polygon points="24,15 30,12 30,18" fill="darkred"/>'; break;
        case '–∫–∏–Ω–¥–∂–∞–ª': svg='<rect x="8" y="4" width="14" height="22" fill="blue"/>'; break;
        case '–∫–∞–ª—ñ–±—Ä': svg='<rect x="8" y="4" width="14" height="22" fill="purple"/>'; break;
        case '—Ö-22': svg='<rect x="5" y="12" width="20" height="6" fill="#AA0000"/><polygon points="5,12 15,7 25,12" fill="#AA0000"/>'; break;
        case '—ñ—Å–∫–∞–Ω–¥–µ—Ä-–º': svg='<rect x="7" y="12" width="16" height="8" fill="#008000"/><polygon points="7,12 15,8 23,12" fill="#008000"/>'; break;
        case '—ñ—Å–∫–∞–Ω–¥–µ—Ä-–∫': svg='<rect x="7" y="12" width="16" height="8" fill="#004080"/><polygon points="7,12 15,8 23,12" fill="#004080"/>'; break;
        case 'kn-23': svg='<rect x="5" y="12" width="20" height="8" fill="#800080"/><polygon points="5,12 15,8 25,12" fill="#800080"/>'; break;
        case '—Ç—É-95': svg='<rect x="5" y="10" width="20" height="10" fill="red"/><polygon points="5,10 10,5 15,10" fill="red"/><polygon points="25,10 20,5 15,10" fill="red"/><polygon points="5,20 10,25 15,20" fill="red"/><polygon points="25,20 20,25 15,20" fill="red"/>'; break;
        case '—Ç—É-160': svg='<rect x="5" y="10" width="20" height="10" fill="purple"/><polygon points="5,10 10,5 15,10" fill="purple"/><polygon points="25,10 20,5 15,10" fill="purple"/><polygon points="5,20 10,25 15,20" fill="purple"/><polygon points="25,20 20,25 15,20" fill="purple"/>'; break;
        case '—Ç—É-22–º3': svg='<rect x="5" y="10" width="20" height="10" fill="orange"/><polygon points="5,10 10,5 15,10" fill="orange"/><polygon points="25,10 20,5 15,10" fill="orange"/><polygon points="5,20 10,25 15,20" fill="orange"/><polygon points="25,20 20,25 15,20" fill="orange"/>'; break;
        case '–º—ñ–≥-31–∫': svg='<rect x="5" y="10" width="20" height="10" fill="teal"/><polygon points="5,10 10,5 15,10" fill="teal"/><polygon points="25,10 20,5 15,10" fill="teal"/><polygon points="5,20 10,25 15,20" fill="teal"/><polygon points="25,20 20,25 15,20" fill="teal"/>'; break;
        case '–ø—É—Å–∫–æ–≤–∞': svg='<polygon points="15,5 20,15 10,15" fill="red"/><rect x="13" y="15" width="4" height="12" fill="red"/>'; break;
        case '–∞–µ—Ä–æ–¥—Ä–æ–º': svg='<circle cx="15" cy="15" r="12" stroke="#2980b9" stroke-width="3" fill="none"/><circle cx="15" cy="15" r="20" stroke="#2980b9" stroke-width="1.5" fill="none"/>'; break;
        default: svg='<circle cx="15" cy="15" r="10" fill="gray"/>';
      }
      return L.divIcon({
        html:`<svg width="40" height="40" viewBox="0 0 30 30" style="transform:rotate(${angle}deg)">${svg}</svg>`,
        iconSize:[40,40],
        iconAnchor:[20,20]
      });
    }

    // –û–±—á–∏—Å–ª–µ–Ω–Ω—è –∫—É—Ç–∞ –º—ñ–∂ –¥–≤–æ–º–∞ —Ç–æ—á–∫–∞–º–∏
    function ang(a,b){
      return (Math.atan2(b.lng-a.lng, b.lat-a.lat)*180/Math.PI+360)%360;
    }

    // –í–∏–∑–Ω–∞—á–µ–Ω–Ω—è —Ç–æ—á–∫–∏ –Ω–∞ –≤—ñ–¥—Å—Ç–∞–Ω—ñ dist –≤ –Ω–∞–ø—Ä—è–º–∫—É bearing –≤—ñ–¥ —Ç–æ—á–∫–∏ a
    function dest(a, bearing, dist=20000){
      const R=6378137, r=bearing*Math.PI/180, lat1=a.lat*Math.PI/180, lng1=a.lng*Math.PI/180;
      const lat2=Math.asin(Math.sin(lat1)*Math.cos(dist/R)+Math.cos(lat1)*Math.sin(dist/R)*Math.cos(r));
      const lng2=lng1+Math.atan2(Math.sin(r)*Math.sin(dist/R)*Math.cos(lat1), Math.cos(dist/R)-Math.sin(lat1)*Math.sin(lat2));
      return L.latLng(lat2*180/Math.PI, lng2*180/Math.PI);
    }

    // –î–æ–¥–∞–≤–∞–Ω–Ω—è —Ü—ñ–ª—ñ
    function addTarget(type, count, start, end, givenId) {
      const a = ang(start, end);
      const id = givenId || ('tg' + (++idCnt));
      const m = L.marker(start, { icon: createIcon(type, count, a), draggable: true }).addTo(map);
      const line = L.polyline([start, end], { color: 'red', dashArray: '5,5' }).addTo(map);
      const arrow = L.marker(end, {
        icon: L.divIcon({
          html: `<svg width="15" viewBox="0 0 30 30" style="transform:rotate(${a}deg)">
                  <polygon points="15,0 30,30 0,30" fill="red"/>
                 </svg>`,
          iconSize: [15, 15],
          iconAnchor: [7, 7]
        }),
        interactive: false
      }).addTo(map);

      m.on('dragend', e => {
        const p = e.target.getLatLng();
        const newEnd = dest(p, a);
        line.setLatLngs([p, newEnd]);
        arrow.setLatLng(newEnd);
        saveTargets();
      });

      line.on('click', e => {
        if(!isLoggedIn) return alert("–ë—É–¥—å –ª–∞—Å–∫–∞, —É–≤—ñ–π–¥—ñ—Ç—å, —â–æ–± –≤–∏–¥–∞–ª—è—Ç–∏ —Ü—ñ–ª—ñ.");
        removeTarget(id);
      });
      m.on('click', e => {
        if(!isLoggedIn) return alert("–ë—É–¥—å –ª–∞—Å–∫–∞, —É–≤—ñ–π–¥—ñ—Ç—å, —â–æ–± –≤–∏–¥–∞–ª—è—Ç–∏ —Ü—ñ–ª—ñ.");
        removeTarget(id);
      });
      arrow.on('click', e => {
        if(!isLoggedIn) return alert("–ë—É–¥—å –ª–∞—Å–∫–∞, —É–≤—ñ–π–¥—ñ—Ç—å, —â–æ–± –≤–∏–¥–∞–ª—è—Ç–∏ —Ü—ñ–ª—ñ.");
        removeTarget(id);
      });

      targets.set(id, {id, type, count, m, line, arrow});
      updateCtr();
      saveTargets();
    }

    // –í–∏–¥–∞–ª–µ–Ω–Ω—è —Ü—ñ–ª—ñ
    function removeTarget(id){
      const obj = targets.get(id);
      if(!obj) return;
      if(obj.m) map.removeLayer(obj.m);
      if(obj.line) map.removeLayer(obj.line);
      if(obj.arrow) map.removeLayer(obj.arrow);
      targets.delete(id);
      updateCtr();
      saveTargets();
    }

    // –ö–Ω–æ–ø–∫–∏ –¥–æ–¥–∞–≤–∞–Ω–Ω—è —Ü—ñ–ª–µ–π/–ª—ñ—Ç–∞–∫—ñ–≤/–ø—É—Å–∫–æ–≤–∏—Ö
    document.getElementById('btn-add-target').onclick = () => {
      if(!isLoggedIn){ alert("–ë—É–¥—å –ª–∞—Å–∫–∞, —É–≤—ñ–π–¥—ñ—Ç—å, —â–æ–± –¥–æ–¥–∞–≤–∞—Ç–∏ —Ü—ñ–ª—ñ."); return; }
      const t = prompt('–¶—ñ–ª—å: —à–∞—Ö–µ–¥, —Ö-101, –∫–∏–Ω–¥–∂–∞–ª, –∫–∞–ª—ñ–±—Ä, —Ö-22, —ñ—Å–∫–∞–Ω–¥–µ—Ä-–º, —ñ—Å–∫–∞–Ω–¥–µ—Ä-–∫, kn-23').toLowerCase();
      if (!['—à–∞—Ö–µ–¥','—Ö-101','–∫–∏–Ω–¥–∂–∞–ª','–∫–∞–ª—ñ–±—Ä','—Ö-22','—ñ—Å–∫–∞–Ω–¥–µ—Ä-–º','—ñ—Å–∫–∞–Ω–¥–µ—Ä-–∫','kn-23'].includes(t)) return alert('–ù–µ–≤—ñ—Ä–Ω–∞ —Ü—ñ–ª—å');
      const c = parseInt(prompt('–ö—ñ–ª—å–∫—ñ—Å—Ç—å:'),10); if(!c || c<1) return alert('–ù–µ–≤—ñ—Ä–Ω–∞ –∫—ñ–ª—å–∫—ñ—Å—Ç—å');
      state = { type: t, count: c }; phase = 5; alert('–ö–ª—ñ–∫ ‚Äì –ø–æ—á–∞—Ç–æ–∫ —Ü—ñ–ª—ñ');
    };

    document.getElementById('btn-add-takeoff').onclick = () => {
      if(!isLoggedIn){ alert("–ë—É–¥—å –ª–∞—Å–∫–∞, —É–≤—ñ–π–¥—ñ—Ç—å, —â–æ–± –¥–æ–¥–∞–≤–∞—Ç–∏ –∑–ª—å–æ—Ç–∏."); return; }
      const t = prompt('–ó–ª—ñ—Ç: —Ç—É-95, —Ç—É-160').toLowerCase();
      if (!['—Ç—É-95','—Ç—É-160'].includes(t)) return alert('–ù–µ–≤—ñ—Ä–Ω–∏–π –∑–ª—ñ—Ç');
      const c = parseInt(prompt('–ö—ñ–ª—å–∫—ñ—Å—Ç—å:'),10); if(!c || c<1) return alert('–ù–µ–≤—ñ—Ä–Ω–∞ –∫—ñ–ª—å–∫—ñ—Å—Ç—å');
      state = { type: t, count: c }; phase = 6; alert('–ö–ª—ñ–∫ ‚Äì —Å—Ç–∞—Ä—Ç –∑–ª—å–æ—Ç—É');
    };

    document.getElementById('btn-add-plane').onclick = () => {
      if(!isLoggedIn){ alert("–ë—É–¥—å –ª–∞—Å–∫–∞, —É–≤—ñ–π–¥—ñ—Ç—å, —â–æ–± –¥–æ–¥–∞–≤–∞—Ç–∏ –ª—ñ—Ç–∞–∫–∏."); return; }
      const t = prompt('–õ—ñ—Ç–∞–∫: —Ç—É-95, —Ç—É-160, —Ç—É-22–º3, –º—ñ–≥-31–∫').toLowerCase();
      if (!['—Ç—É-95','—Ç—É-160','—Ç—É-22–º3','–º—ñ–≥-31–∫'].includes(t)) return alert('–ù–µ–≤—ñ—Ä–Ω–∏–π –ª—ñ—Ç–∞–∫');
      const c = parseInt(prompt('–ö—ñ–ª—å–∫—ñ—Å—Ç—å:'),10); if(!c || c<1) return alert('–ù–µ–≤—ñ—Ä–Ω–∞ –∫—ñ–ª—å–∫—ñ—Å—Ç—å');
      state = { type: t, count: c }; phase = 7; alert('–ö–ª—ñ–∫ ‚Äì –ø–æ–∑–∏—Ü—ñ—è –ª—ñ—Ç–∞–∫–∞');
    };

    document.getElementById('btn-add-launcher').onclick = () => {
      if(!isLoggedIn){ alert("–ë—É–¥—å –ª–∞—Å–∫–∞, —É–≤—ñ–π–¥—ñ—Ç—å, —â–æ–± –¥–æ–¥–∞–≤–∞—Ç–∏ –ø—É—Å–∫–æ–≤—ñ —É—Å—Ç–∞–Ω–æ–≤–∫–∏."); return; }
      const c = parseInt(prompt('–ö—ñ–ª—å–∫—ñ—Å—Ç—å:'),10); if(!c || c<1) return alert('–ù–µ–≤—ñ—Ä–Ω–∞ –∫—ñ–ª—å–∫—ñ—Å—Ç—å');
      state = { type: '–ø—É—Å–∫–æ–≤–∞', count: c }; phase = 8; alert('–ö–ª—ñ–∫ ‚Äì –ø–æ–∑–∏—Ü—ñ—è –ø—É—Å–∫–æ–≤–æ—ó —É—Å—Ç–∞–Ω–æ–≤–∫–∏');
    };

    // –õ–æ–≥—ñ–∫–∞ –∫–ª—ñ–∫—ñ–≤ –¥–ª—è –¥–æ–¥–∞–≤–∞–Ω–Ω—è —Ü—ñ–ª–µ–π/–æ–±'—î–∫—Ç—ñ–≤
    map.on('click', e => {
      if(!isLoggedIn) return;
      if(phase === 5){
        // –°—Ç–∞—Ä—Ç —Ü—ñ–ª—ñ
        state.start = e.latlng;
        alert('–ö–ª—ñ–∫ ‚Äì –∫—ñ–Ω–µ—Ü—å —Ü—ñ–ª—ñ');
        phase = 51;
      } else if(phase === 51){
        // –ö—ñ–Ω–µ—Ü—å —Ü—ñ–ª—ñ
        addTarget(state.type, state.count, state.start, e.latlng);
        phase = 0; state = {};
      } else if(phase === 6){
        // –°—Ç–∞—Ä—Ç –∑–ª—å–æ—Ç—É (–æ–¥–Ω–∞ —Ç–æ—á–∫–∞, –ø—Ä–æ—Å—Ç–æ –¥–æ–¥–∞—î–º–æ –º–∞—Ä–∫–µ—Ä)
        addTarget(state.type, state.count, e.latlng, dest(e.latlng, 0));
        phase = 0; state = {};
      } else if(phase === 7){
        // –ü–æ–∑–∏—Ü—ñ—è –ª—ñ—Ç–∞–∫–∞
        addTarget(state.type, state.count, e.latlng, dest(e.latlng, 0));
        phase = 0; state = {};
      } else if(phase === 8){
        // –ü—É—Å–∫–æ–≤–∞ —É—Å—Ç–∞–Ω–æ–≤–∫–∞ –ø–æ–∑–∏—Ü—ñ—è
        addTarget(state.type, state.count, e.latlng, dest(e.latlng, 0));
        phase = 0; state = {};
      }
    });

    // –ó–±–µ—Ä–µ–∂–µ–Ω–Ω—è —Å—Ç–∞—Ç—É—Å—ñ–≤
    function saveStatus(){
      const statuses = {
        strat: document.getElementById('strat-ind').classList.contains('active'),
        takeoff: document.getElementById('takeoff-ind').classList.contains('active'),
        mig: document.getElementById('mig-ind').classList.contains('active'),
        ballistic: document.getElementById('ballistic-ind').classList.contains('active')
      };
      localStorage.setItem('statuses', JSON.stringify(statuses));
    }

    // –ó–∞–≤–∞–Ω—Ç–∞–∂–µ–Ω–Ω—è —Å—Ç–∞—Ç—É—Å—ñ–≤
    function loadStatus(){
      const s = localStorage.getItem('statuses');
      if(!s) return;
      const statuses = JSON.parse(s);
      if(statuses.strat) {
        document.getElementById('strat-ind').classList.add('active'); 
        document.getElementById('strat-ind').classList.remove('inactive'); 
        document.getElementById('strat-ind').textContent = '–°—Ç—Ä–∞—Ç–µ–≥—ñ—á–Ω–∞ –∞–≤—ñ–∞—Ü—ñ—è: –∞–∫—Ç–∏–≤–Ω–∞';
      }
      if(statuses.takeoff) {
        document.getElementById('takeoff-ind').classList.add('active'); 
        document.getElementById('takeoff-ind').classList.remove('inactive'); 
        document.getElementById('takeoff-ind').textContent = '–ó–ª—ñ—Ç –¢—É‚Äë95/160: –≤—ñ–¥–±—É–≤—Å—è';
      }
      if(statuses.mig) {
        document.getElementById('mig-ind').classList.add('active'); 
        document.getElementById('mig-ind').classList.remove('inactive'); 
        document.getElementById('mig-ind').textContent = '–ó–ª—ñ—Ç –ú—ñ–ì‚Äë31–ö: –≤—ñ–¥–±—É–≤—Å—è';
      }
      if(statuses.ballistic) {
        document.getElementById('ballistic-ind').classList.add('active'); 
        document.getElementById('ballistic-ind').classList.remove('inactive'); 
        document.getElementById('ballistic-ind').textContent = '–ó–∞–≥—Ä–æ–∑–∞ –±–∞–ª—ñ—Å—Ç–∏–∫–∞: –∞–∫—Ç–∏–≤–Ω–∞';
      }
    }

    // –ó–±–µ—Ä–µ–∂–µ–Ω–Ω—è —Ü—ñ–ª–µ–π
    function saveTargets(){
      const arr = [];
      targets.forEach(obj => {
        const m = obj.m.getLatLng();
        const lineLatLngs = obj.line.getLatLngs();
        arr.push({
          id: obj.id,
          type: obj.type,
          count: obj.count,
          start: { lat: m.lat, lng: m.lng },
          end: { lat: lineLatLngs[1].lat, lng: lineLatLngs[1].lng }
        });
      });
      localStorage.setItem('targets', JSON.stringify(arr));
    }

    // –ó–∞–≤–∞–Ω—Ç–∞–∂–µ–Ω–Ω—è —Ü—ñ–ª–µ–π
    function loadTargets(){
      const data = localStorage.getItem('targets');
      if(!data) return;
      const arr = JSON.parse(data);
      arr.forEach(o => {
        addTarget(o.type, o.count, L.latLng(o.start.lat, o.start.lng), L.latLng(o.end.lat, o.end.lng), o.id);
      });
      updateCtr();
    }

    // –û—á–∏—Å—Ç–∏—Ç–∏ –≤—Å—ñ —Ü—ñ–ª—ñ
    document.getElementById('btn-clear').onclick = () => {
      if(!isLoggedIn){ alert("–ë—É–¥—å –ª–∞—Å–∫–∞, —É–≤—ñ–π–¥—ñ—Ç—å, —â–æ–± –æ—á–∏—Å—Ç–∏—Ç–∏ —Ü—ñ–ª—ñ."); return; }
      targets.forEach(o => {
        if (o.m) map.removeLayer(o.m);
        if (o.line) map.removeLayer(o.line);
        if (o.arrow) map.removeLayer(o.arrow);
      });
      targets.clear();
      updateCtr();
      localStorage.removeItem('targets');
    };

    // –û–Ω–æ–≤–∏—Ç–∏ (–ø–µ—Ä–µ–∑–∞–≤–∞–Ω—Ç–∞–∂–µ–Ω–Ω—è —Å—Ç–æ—Ä—ñ–Ω–∫–∏, —Ü—ñ–ª—ñ –∑–±–µ—Ä–µ–∂—É—Ç—å—Å—è)
    document.getElementById('btn-refresh').onclick = () => location.reload();

    // –ü–æ—á–∞—Ç–∫–æ–≤–µ –∑–∞–≤–∞–Ω—Ç–∞–∂–µ–Ω–Ω—è
    loadStatus();
    loadTargets();
    updateCtr();
  </script>
</body>
</html>
